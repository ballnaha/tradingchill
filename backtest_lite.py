import csv
import io

data = """Date;Open;High;Low;Close;Volume
2025-08-25;226.261;229.078;226.011;226.94;31013167
2025-08-26;226.65;229.268;224.472;229.088;54628011
2025-08-27;228.389;230.676;228.039;230.267;31289815
2025-08-28;230.596;233.184;229.113;232.335;38111609
2025-08-29;232.285;233.154;231.146;231.915;39456648
2025-09-02;229.028;230.626;226.75;229.498;44118364
2025-09-03;236.98;238.619;234.133;238.239;66492229
2025-09-04;238.219;239.668;236.511;239.548;47595522
2025-09-05;239.763;241.086;238.259;239.458;54923587
2025-09-08;239.068;239.917;236.111;237.65;49046994
2025-09-09;236.77;238.549;233.134;234.123;66378202
2025-09-10;231.96;232.195;225.731;226.57;83521696
2025-09-11;226.655;230.227;226.431;229.807;50257249
2025-09-12;228.998;234.283;228.798;233.843;55878331
2025-09-15;236.77;237.959;234.802;236.471;42740916
2025-09-16;236.945;240.986;236.095;237.919;63482578
2025-09-17;238.739;239.867;237.5;238.759;46553101
2025-09-18;239.738;240.966;236.421;237.65;44292471
2025-09-19;240.991;246.061;239.978;245.262;163900043
2025-09-22;248.06;256.391;247.88;255.832;105619703
2025-09-23;255.627;257.091;253.334;254.184;60333617
2025-09-24;254.973;255.492;250.797;252.066;42344718
2025-09-25;252.96;256.921;251.468;256.621;55255587
2025-09-26;253.849;257.351;253.534;255.213;46120923
2025-09-29;254.313;254.753;252.765;254.184;40166586
2025-09-30;254.608;255.671;252.865;254.383;37740809
2025-10-01;254.793;258.539;254.683;255.203;48761162
2025-10-02;256.327;257.93;253.904;256.881;42671564
2025-10-03;254.418;258.989;253.704;257.77;49203264
2025-10-06;257.74;258.819;254.803;256.441;44707414
2025-10-07;256.556;257.151;255.183;256.232;31986753
2025-10-08;256.272;258.27;255.862;257.81;36532274
2025-10-09;257.555;257.75;252.895;253.794;38359160
2025-10-10;254.693;256.132;243.764;245.032;62059199
2025-10-13;249.138;249.448;245.322;247.42;38179917
2025-10-14;246.361;248.604;244.463;247.53;35512377
2025-10-15;249.243;251.576;247.23;249.099;33926467
2025-10-16;248.01;248.799;244.893;247.21;39815533
2025-10-17;247.78;253.135;247.031;252.046;49194603
2025-10-20;255.637;264.119;255.382;261.986;90570742
2025-10-21;261.626;265.033;261.576;262.516;46741214
2025-10-22;262.396;262.595;255.183;258.2;45058891
2025-10-23;259.688;260.368;257.76;259.329;32786693
2025-10-24;260.937;263.874;258.929;262.565;38290799
2025-10-27;264.623;268.859;264.394;268.55;44931666
2025-10-28;268.725;269.629;267.89;268.739;41575022
2025-10-29;269.014;271.147;266.851;269.439;51136264
2025-10-30;271.727;273.875;268.22;271.137;69954281
2025-10-31;276.722;277.051;268.899;270.108;86250652
2025-11-03;270.158;270.588;265.992;268.789;50243241
2025-11-04;268.065;271.223;267.356;269.778;49322612
2025-11-05;268.35;271.437;266.671;269.878;43725417
2025-11-06;267.631;273.135;267.631;269.509;51253681
2025-11-07;269.534;272.026;266.512;268.21;48274116
2025-11-10;268.96;273.73;267.455;269.43;41312412
2025-11-11;269.81;275.91;269.8;275.25;46208318
2025-11-12;275;275.73;271.7;273.47;48397982
2025-11-13;274.11;276.699;272.09;272.95;49602794
2025-11-14;271.05;275.96;269.6;272.41;47431331
2025-11-17;268.815;270.49;265.73;267.46;45018260
2025-11-18;269.99;270.71;265.32;267.44;45677278
2025-11-19;265.525;272.21;265.5;268.56;40424492
2025-11-20;270.83;275.43;265.92;266.25;45823568
2025-11-21;265.95;273.33;265.67;271.49;59030832
2025-11-24;270.9;277;270.9;275.92;65585796
2025-11-25;275.27;280.38;275.25;276.97;46914220
2025-11-26;276.96;279.53;276.63;277.55;33431423
2025-11-28;277.26;279;275.986;278.85;20135620
2025-12-01;278.01;283.42;276.14;283.1;46587722
2025-12-02;283;287.4;282.63;286.19;53669532
2025-12-03;286.2;288.62;283.3;284.15;43538687
2025-12-04;284.095;284.73;278.59;280.7;43989056
2025-12-05;280.54;281.14;278.05;278.78;47265845
2025-12-08;278.13;279.669;276.15;277.89;38211832
2025-12-09;278.16;280.03;276.92;277.18;32193256
2025-12-10;277.75;279.75;276.44;278.78;33038318
2025-12-11;279.095;279.59;273.81;278.03;33247986
2025-12-12;277.9;279.22;276.82;278.28;39532887
2025-12-15;280.15;280.15;272.84;274.11;50409078
2025-12-16;272.82;275.5;271.79;274.61;37648628
2025-12-17;275.01;276.16;271.64;271.84;50138743
2025-12-18;273.605;273.63;266.95;272.19;51630721
2025-12-19;272.145;274.6;269.9;273.67;144632048
2025-12-22;272.86;273.88;270.505;270.97;36571827
2025-12-23;270.84;272.5;269.56;272.36;29641999
2025-12-24;272.34;275.43;272.195;273.81;17910574
2025-12-26;274.16;275.37;272.86;273.4;21521802
2025-12-29;272.69;274.36;272.35;273.76;23715213
2025-12-30;272.81;274.08;272.28;273.08;22139617
2025-12-31;273.06;273.68;271.75;271.86;27293639
2026-01-02;272.255;277.84;269;271.01;37838054
2026-01-05;270.64;271.51;266.14;267.26;45647190
2026-01-06;267;267.55;262.12;262.36;52352090
2026-01-07;263.2;263.68;259.81;260.33;48309804
2026-01-08;257.02;259.29;255.7;259.04;50419337
2026-01-09;259.075;260.21;256.22;259.37;39996967
2026-01-12;259.16;261.3;256.8;260.25;45263767
2026-01-13;258.72;261.81;258.39;261.05;45730847
2026-01-14;259.49;261.82;256.71;259.96;40019421
2026-01-15;260.65;261.04;257.05;258.21;39388564
2026-01-16;257.9;258.9;254.93;255.53;72142773
2026-01-20;252.73;254.79;243.42;246.7;80267517
2026-01-21;248.7;251.56;245.18;247.65;54641725
2026-01-22;249.2;251;248.15;248.35;39708340
2026-01-23;247.32;249.41;244.68;248.04;41688982
2026-01-26;251.48;256.56;249.8;255.41;55969234
2026-01-27;259.17;261.95;258.21;258.27;49648271
2026-01-28;257.65;258.855;254.51;256.44;41287971
2026-01-29;258;259.65;254.41;258.28;67253009
2026-01-30;255.165;261.8999;252.18;259.48;92443408
2026-02-02;260.03;270.49;259.205;270.01;73913425
2026-02-03;269.2;271.875;267.61;269.48;64394655
2026-02-04;272.285;278.95;272.285;276.49;90545710
2026-02-05;278.13;279.5;273.23;275.91;52977441
2026-02-06;277.12;280.905;276.925;278.12;50453414
2026-02-09;277.905;278.2;271.7;274.62;44623396
2026-02-10;274.885;275.37;272.94;273.68;34376898
2026-02-11;274.695;280.18;274.45;275.5;51931283
2026-02-12;275.59;275.72;260.18;261.73;81077229
2026-02-13;262.01;262.23;255.45;255.78;56290673
2026-02-17;258.05;266.29;255.54;263.88;58469094
2026-02-18;263.6;266.82;262.45;264.35;34203337
2026-02-19;262.6;264.48;260.05;260.58;30845294
2026-02-20;258.97;264.75;258.16;264.58;42070499
2026-02-23;263.49;269.43;263.381;266.18;310775
2026-02-24;267.86;274.89;267.71;272.14;310775"""

f = io.StringIO(data)
reader = csv.DictReader(f, delimiter=';')
rows = list(reader)
prices = [float(row['Close']) for row in rows]

def get_rsi(closes):
    if len(closes) < 15: return 50
    deltas = [closes[i] - closes[i-1] for i in range(1, len(closes))]
    gains = [d if d > 0 else 0 for d in deltas]
    losses = [-d if d < 0 else 0 for d in deltas]
    avg_gain = sum(gains[-14:]) / 14
    avg_loss = sum(losses[-14:]) / 14
    if avg_loss == 0: return 100
    rs = avg_gain / avg_loss
    return 100 - (100 / (1 + rs))

total_preds = 0
correct_preds = 0

for i in range(20, len(prices) - 3):
    history = prices[:i+1]
    price = prices[i]
    rsi = get_rsi(history)
    sma20 = sum(prices[i-19:i+1]) / 20
    pct = ((price - prices[i-1]) / prices[i-1]) * 100
    
    score = 0
    if rsi < 30: score += 3
    elif rsi < 40: score += 1.5
    elif rsi > 70: score -= 3
    elif rsi > 60: score -= 1.5
    
    price_to_sma = (price - sma20) / sma20
    if price_to_sma > 0.02: score += 1
    elif price_to_sma < -0.02: score -= 1
    
    if pct > 1: score += 1
    elif pct < -1: score -= 1
    
    trend = 'UP' if score > 0.5 else 'DOWN' if score < -0.5 else 'Neutral'
    
    if trend == 'Neutral': continue
    
    total_preds += 1
    future_price = prices[i+3]
    
    if trend == 'UP' and future_price > price:
        correct_preds += 1
    elif trend == 'DOWN' and future_price < price:
        correct_preds += 1

accuracy = (correct_preds / total_preds) * 100 if total_preds > 0 else 0
print(f"RESULTS: {accuracy:.2f}% accuracy over {total_preds} predictions")
